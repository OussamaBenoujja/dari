services:
  darna-api:
    build:
      context: ./apps/darna
    environment:
      - PORT=3001
      - MONGO_URI=mongodb://mongo:27017/darna
      - KEYCLOAK_URL=http://keycloak:8080
      - KEYCLOAK_REALM=darna
      - KEYCLOAK_CLIENT_ID=darna-api
      - MINIO_ENDPOINT=minio
      - MINIO_PORT=9000
      - MINIO_USE_SSL=false
      - MINIO_ACCESS_KEY=minioadmin
      - MINIO_SECRET_KEY=minioadmin123
      - MINIO_BUCKET=darna-media
      - MINIO_PUBLIC_BASE_URL=http://localhost:9000/darna-media
      - TIRELIRE_BASE_URL=http://tirelire-api:3002/api
      - TIRELIRE_SERVICE_EMAIL=tirelire-service@darna.local
      - TIRELIRE_SERVICE_PASSWORD=please-change-me
    ports:
      - "3001:3001"
    depends_on:
      - mongo
      - keycloak
      - minio

  tirelire-api:
    build:
      context: ./apps/tirelire
    environment:
      - PORT=3002
      - mongoLink=mongodb://mongo:27017/tirelire
      - KEYCLOAK_URL=http://keycloak:8080
      - KEYCLOAK_REALM=darna
      - KEYCLOAK_CLIENT_ID=tirelire-api
    ports:
      - "3002:3002"
    depends_on:
      - mongo
      - keycloak

  keycloak:
    build:
      context: ./apps/keycloak
    environment:
      - KEYCLOAK_ADMIN=admin
      - KEYCLOAK_ADMIN_PASSWORD=admin
    ports:
      - "8080:8080"

  minio:
    image: minio/minio:RELEASE.2024-10-13T13-34-11Z
    command: server /data --console-address ":9001"
    environment:
      - MINIO_ROOT_USER=minioadmin
      - MINIO_ROOT_PASSWORD=minioadmin123
    ports:
      - "9000:9000"
      - "9001:9001"
    volumes:
      - minio_data:/data

  mongo:
    image: mongo:6
    restart: always
    ports:
      - "27017:27017"
    volumes:
      - mongo_data:/data/db

volumes:
  mongo_data:
  minio_data: